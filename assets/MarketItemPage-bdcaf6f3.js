import{z as S,r as d,A as T,j as e,S as n,C as z,H as y,n as m,y as v,t as A,T as b}from"./index-aa8efdd4.js";import{C as B,b as O}from"./index-0608eb0f.js";import{u as F,c as I,F as P,I as U,B as w,e as C}from"./utils-bc91bf48.js";import{R as E,L as R,C as D,X as H,Y as W,T as K,a as N,b as X}from"./LineChart-38cc7a9d.js";import{u as L,I as Y}from"./chunk-BBVTFCMB-d10e72b0.js";import{M as q,b as G,c as J,d as Q,e as V,f as Z,u as ee}from"./chunk-4FCEGNGT-ae88ae8b.js";import{F as se}from"./chunk-GCOAS5YC-94a25005.js";function te({isOpen:i,onClose:f,type:c,item:s,getData:k}){const h=S(),[o,u]=d.useState(),[r,l]=L(!1),x=F(),p=d.useContext(T),[$,_]=d.useState([]),[j]=d.useState("week"),a=async()=>{try{const{data:t}=await m.get(`https://api.silentclient.net/marketplace/item/${h.type}/${h.id}/get_median_sales?type=${j}`);_(t.sales)}catch(t){C(t,x)}};return d.useEffect(()=>{a()},[j]),e.jsx(e.Fragment,{children:e.jsxs(q,{size:"2xl",isOpen:i,onClose:f,children:[e.jsx(G,{}),e.jsxs(J,{bgColor:"#131313",children:[e.jsxs(Q,{children:[I(c)," ",s==null?void 0:s.item.name]}),e.jsx(V,{}),e.jsx(Z,{pt:0,mb:2,children:e.jsxs(n,{direction:"column",spacing:2,children:[$.length!==0&&e.jsx(E,{aspect:2.5,width:"100%",children:e.jsxs(R,{width:500,height:300,margin:{left:-25},data:$.map(t=>({name:t.date,Price:(t.median_price/100).toFixed(2)})),children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"name"}),e.jsx(W,{}),e.jsx(K,{formatter:t=>t+"$",contentStyle:{background:"#151515",border:"none",borderRadius:"15px"}}),e.jsx(N,{}),e.jsx(X,{type:"monotone",dataKey:"Price",stroke:"white"})]})})||e.jsx(z,{children:e.jsx(y,{size:"sm",children:"Sales not found"})}),e.jsxs(P,{children:[e.jsx(se,{children:c==="order"?"Max price":"Price"}),e.jsx(U,{value:o,onChange:t=>u(t.currentTarget.value),placeholder:"Price"})]}),e.jsx(w,{onClick:async()=>{try{l.on();const{data:t}=await m.post(`https://api.silentclient.net/marketplace/item/${h.type}/${h.id}/${c==="sell"?"create_lot":"create_order"}`,{price:parseFloat((o==null?void 0:o.replaceAll(",","."))||"0")*100,max_price:parseFloat((o==null?void 0:o.replaceAll(",","."))||"0")*100},{headers:{Authorization:`Bearer ${p.props.accessToken}`}});f(),u(""),x({title:`${c==="order"?"Order":"Lot"} created!`,status:"success",duration:3e3,isClosable:!0}),c==="order"?t.order||x({title:"The order has been completed!",status:"success",duration:3e3,isClosable:!0}):t.lot.status==="sold"&&x({title:"The lot has been sold!",status:"success",duration:3e3,isClosable:!0})}catch(t){C(t,x)}finally{k(),p.updateUser(),l.off()}},isDisabled:r,children:I(c)})]})})]})]})})}function de(){var j;const i=S(),[f,c]=L(!0),[s,k]=d.useState(null),[h,o]=d.useState("sell"),u=ee(),r=d.useContext(T),l=F(),x=v(),p=async a=>{a||c.on();try{const{data:t}=await m.get(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}`);k(t.info)}catch(t){C(t,l),x("/")}finally{c.off()}};d.useEffect(()=>{p(),r.updateUser();const a=setInterval(()=>{f||(p(!0),r.updateUser())},1e4);return()=>clearInterval(a)},[]);const $=(s==null?void 0:s.lots.length)!==0?(((s==null?void 0:s.lots[0].price)||0)/100).toFixed(2)+"$":"Unknown",_=(s==null?void 0:s.orders.length)!==0?(((s==null?void 0:s.orders[0].max_price)||0)/100).toFixed(2)+"$":"Unknown";return e.jsxs(e.Fragment,{children:[f&&e.jsx(z,{w:"full",p:5,children:e.jsx(A,{size:"xl",color:"white"})})||e.jsxs(B,{maxW:"container.xl",children:[e.jsxs(n,{direction:["column","row"],justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{alignItems:["start","center"],direction:["column","row"],spacing:3,children:[e.jsx(z,{bgColor:"#131313",borderRadius:"xl",p:2,children:e.jsx(Y,{src:`https://api.silentclient.net${s==null?void 0:s.item.preview}`,w:["full","200px"],h:["auto","200px"]})}),e.jsxs(n,{direction:"column",spacing:1,children:[e.jsx(y,{size:"md",children:s==null?void 0:s.item.name}),e.jsx(b,{opacity:"0.8",fontSize:"md",children:s==null?void 0:s.item.category}),e.jsx(y,{size:"md",children:$})]})]}),e.jsxs(n,{maxW:["full","30%"],w:["full","auto"],alignItems:["start","center"],direction:"column",spacing:2,children:[e.jsxs(b,{fontSize:"md",children:[s==null?void 0:s.orders.length," ",e.jsx("span",{style:{opacity:"0.8"},children:"requests to buy at"})," ",_," ",e.jsx("span",{style:{opacity:"0.8"},children:"or lower"})]}),(s==null?void 0:s.orders.find(a=>{var t;return a.user_id===((t=r.props.account)==null?void 0:t.id)}))&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{textAlign:"left",w:"full",children:["My order:"," ",((((j=s==null?void 0:s.orders.find(a=>{var t;return a.user_id===((t=r.props.account)==null?void 0:t.id)}))==null?void 0:j.max_price)||0)/100).toFixed(2),"$"]}),e.jsx(w,{w:"full",onClick:async()=>{const a=s==null?void 0:s.orders.find(t=>{var g;return t.user_id===((g=r.props.account)==null?void 0:g.id)});try{await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/delete_order`,{id:a==null?void 0:a.id},{headers:{Authorization:`Bearer ${r.props.accessToken}`}}),l({title:"Order was canceled",status:"success",duration:3e3,isClosable:!0})}catch(t){C(t,l)}finally{p()}},size:"md",fontSize:"xl",children:"Cancel Order"})]})||e.jsx(w,{w:"full",onClick:()=>{r.props.account?(o("order"),u.onOpen()):window.location.href=`https://auth.silentclient.net/login?redirect_url=${window.location.href}`},size:"md",fontSize:"xl",children:"Order"})]})]}),e.jsx(n,{alignItems:"center",justifyContent:"center",direction:"row",spacing:5,mt:5,children:e.jsxs(n,{direction:"column",w:["full","70%"],spacing:2,children:[e.jsxs(n,{alignItems:"center",direction:"row",justifyContent:"space-between",children:[e.jsx(y,{size:"md",children:"Lots"}),e.jsx(w,{w:"100px",onClick:()=>{r.props.account?(o("sell"),u.onOpen()):window.location.href=`https://auth.silentclient.net/login?redirect_url=${window.location.href}`},children:"Sell Item"})]}),s==null?void 0:s.lots.map(a=>{var t;return e.jsxs(n,{direction:"row",justifyContent:"space-between",spacing:2,alignItems:["start","center"],children:[e.jsxs(n,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(O.LazyLoadImage,{src:`https://mc-heads.net/avatar/${a.user.username}.png`,width:"50px",height:"50px",className:"market-lot-avatar"}),e.jsxs(n,{direction:"column",spacing:0,children:[e.jsxs(y,{size:"sm",children:[(a.price/100).toFixed(2),"$"]}),e.jsxs(b,{opacity:"0.8",children:["by ",a.user.username]})]})]}),e.jsx(w,{onClick:async()=>{var g;try{if(a.user_id===((g=r.props.account)==null?void 0:g.id)){await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/delete_lot`,{id:a.id},{headers:{Authorization:`Bearer ${r.props.accessToken}`}}),l({title:"Lot was canceled",status:"success",duration:3e3,isClosable:!0});return}await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/buy_lot`,{id:a.id},{headers:{Authorization:`Bearer ${r.props.accessToken}`}}),l({title:"Lot was buyed",status:"success",duration:3e3,isClosable:!0})}catch(M){C(M,l)}finally{p(),r.updateUser()}},maxW:"100px",w:"full",children:a.user_id===((t=r.props.account)==null?void 0:t.id)?"Cancel":"Buy"})]})})]})})]}),e.jsx(te,{isOpen:u.isOpen,onClose:u.onClose,item:s,getData:p,type:h})]})}export{de as default};
