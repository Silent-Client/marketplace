import{x as T,r as d,A as F,j as e,S as r,C as z,H as w,n as m,w as A,t as B,T as b}from"./index-1c35740b.js";import{u as L,c as S,F as O,I as P,B as y,e as C}from"./utils-048207bb.js";import{R as U,L as R,C as D,X as E,Y as H,T as W,a as K,b as X}from"./LineChart-be31fb18.js";import{u as M,I}from"./chunk-BBVTFCMB-7930a90f.js";import{M as Y,b as q,c as G,d as N,e as J,f as Q,u as V}from"./chunk-4FCEGNGT-a20f46af.js";import{F as Z}from"./chunk-GCOAS5YC-71d40e32.js";import{C as ee}from"./chunk-5MKCW436-e8ffe9c8.js";function se({isOpen:i,onClose:f,type:c,item:s,getData:k}){const h=T(),[o,u]=d.useState(),[a,l]=M(!1),x=L(),p=d.useContext(F),[$,_]=d.useState([]),[j]=d.useState("week"),n=async()=>{try{const{data:t}=await m.get(`https://api.silentclient.net/marketplace/item/${h.type}/${h.id}/get_median_sales?type=${j}`);_(t.sales)}catch(t){C(t,x)}};return d.useEffect(()=>{n()},[j]),e.jsx(e.Fragment,{children:e.jsxs(Y,{size:"2xl",isOpen:i,onClose:f,children:[e.jsx(q,{}),e.jsxs(G,{bgColor:"#131313",children:[e.jsxs(N,{children:[S(c)," ",s==null?void 0:s.item.name]}),e.jsx(J,{}),e.jsx(Q,{pt:0,mb:2,children:e.jsxs(r,{direction:"column",spacing:2,children:[$.length!==0&&e.jsx(U,{aspect:2.5,width:"100%",children:e.jsxs(R,{width:500,height:300,margin:{left:-25},data:$.map(t=>({name:t.date,Price:(t.median_price/100).toFixed(2)})),children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"name"}),e.jsx(H,{}),e.jsx(W,{formatter:t=>t+"$",contentStyle:{background:"#151515",border:"none",borderRadius:"15px"}}),e.jsx(K,{}),e.jsx(X,{type:"monotone",dataKey:"Price",stroke:"white"})]})})||e.jsx(z,{children:e.jsx(w,{size:"sm",children:"Sales not found"})}),e.jsxs(O,{children:[e.jsx(Z,{children:c==="order"?"Max price":"Price"}),e.jsx(P,{value:o,onChange:t=>u(t.currentTarget.value),placeholder:"Price"})]}),e.jsx(y,{onClick:async()=>{try{l.on();const{data:t}=await m.post(`https://api.silentclient.net/marketplace/item/${h.type}/${h.id}/${c==="sell"?"create_lot":"create_order"}`,{price:parseFloat((o==null?void 0:o.replaceAll(",","."))||"0")*100,max_price:parseFloat((o==null?void 0:o.replaceAll(",","."))||"0")*100},{headers:{Authorization:`Bearer ${p.props.accessToken}`}});f(),u(""),x({title:`${c==="order"?"Order":"Lot"} created!`,status:"success",duration:3e3,isClosable:!0}),c==="order"?t.order||x({title:"The order has been completed!",status:"success",duration:3e3,isClosable:!0}):t.lot.status==="sold"&&x({title:"The lot has been sold!",status:"success",duration:3e3,isClosable:!0})}catch(t){C(t,x)}finally{k(),p.updateUser(),l.off()}},isDisabled:a,children:S(c)})]})})]})]})})}function le(){var j;const i=T(),[f,c]=M(!0),[s,k]=d.useState(null),[h,o]=d.useState("sell"),u=V(),a=d.useContext(F),l=L(),x=A(),p=async n=>{n||c.on();try{const{data:t}=await m.get(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}`);k(t.info)}catch(t){C(t,l),x("/")}finally{c.off()}};d.useEffect(()=>{p(),a.updateUser();const n=setInterval(()=>{f||(p(!0),a.updateUser())},1e4);return()=>clearInterval(n)},[]);const $=(s==null?void 0:s.lots.length)!==0?(((s==null?void 0:s.lots[0].price)||0)/100).toFixed(2)+"$":"Unknown",_=(s==null?void 0:s.orders.length)!==0?(((s==null?void 0:s.orders[0].max_price)||0)/100).toFixed(2)+"$":"Unknown";return e.jsxs(e.Fragment,{children:[f&&e.jsx(z,{w:"full",p:5,children:e.jsx(B,{size:"xl",color:"white"})})||e.jsxs(ee,{maxW:"container.xl",children:[e.jsxs(r,{direction:["column","row"],justifyContent:"space-between",alignItems:"center",children:[e.jsxs(r,{alignItems:["start","center"],direction:["column","row"],spacing:3,children:[e.jsx(z,{bgColor:"#131313",borderRadius:"xl",p:2,children:e.jsx(I,{src:`https://api.silentclient.net${s==null?void 0:s.item.preview}`,w:["full","200px"],h:["auto","200px"]})}),e.jsxs(r,{direction:"column",spacing:1,children:[e.jsx(w,{size:"md",children:s==null?void 0:s.item.name}),e.jsx(b,{opacity:"0.8",fontSize:"md",children:s==null?void 0:s.item.category}),e.jsx(w,{size:"md",children:$})]})]}),e.jsxs(r,{maxW:["full","30%"],w:["full","auto"],alignItems:["start","center"],direction:"column",spacing:2,children:[e.jsxs(b,{fontSize:"md",children:[s==null?void 0:s.orders.length," ",e.jsx("span",{style:{opacity:"0.8"},children:"requests to buy at"})," ",_," ",e.jsx("span",{style:{opacity:"0.8"},children:"or lower"})]}),(s==null?void 0:s.orders.find(n=>{var t;return n.user_id===((t=a.props.account)==null?void 0:t.id)}))&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{textAlign:"left",w:"full",children:["My order:"," ",((((j=s==null?void 0:s.orders.find(n=>{var t;return n.user_id===((t=a.props.account)==null?void 0:t.id)}))==null?void 0:j.max_price)||0)/100).toFixed(2),"$"]}),e.jsx(y,{w:"full",onClick:async()=>{const n=s==null?void 0:s.orders.find(t=>{var g;return t.user_id===((g=a.props.account)==null?void 0:g.id)});try{await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/delete_order`,{id:n==null?void 0:n.id},{headers:{Authorization:`Bearer ${a.props.accessToken}`}}),l({title:"Order was canceled",status:"success",duration:3e3,isClosable:!0})}catch(t){C(t,l)}finally{p()}},size:"md",fontSize:"xl",children:"Cancel Order"})]})||e.jsx(y,{w:"full",onClick:()=>{a.props.account?(o("order"),u.onOpen()):window.location.href=`https://auth.silentclient.net/login?redirect_url=${window.location.href}`},size:"md",fontSize:"xl",children:"Order"})]})]}),e.jsx(r,{alignItems:"center",justifyContent:"center",direction:"row",spacing:5,mt:5,children:e.jsxs(r,{direction:"column",w:["full","70%"],spacing:2,children:[e.jsxs(r,{alignItems:"center",direction:"row",justifyContent:"space-between",children:[e.jsx(w,{size:"md",children:"Lots"}),e.jsx(y,{w:"100px",onClick:()=>{a.props.account?(o("sell"),u.onOpen()):window.location.href=`https://auth.silentclient.net/login?redirect_url=${window.location.href}`},children:"Sell Item"})]}),s==null?void 0:s.lots.map(n=>{var t;return e.jsxs(r,{direction:"row",justifyContent:"space-between",spacing:2,alignItems:["start","center"],children:[e.jsxs(r,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(I,{src:`https://mc-heads.net/avatar/${n.user.username}.png`,w:"50px",h:"50px"}),e.jsxs(r,{direction:"column",spacing:0,children:[e.jsxs(w,{size:"sm",children:[(n.price/100).toFixed(2),"$"]}),e.jsxs(b,{opacity:"0.8",children:["by ",n.user.username]})]})]}),e.jsx(y,{onClick:async()=>{var g;try{if(n.user_id===((g=a.props.account)==null?void 0:g.id)){await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/delete_lot`,{id:n.id},{headers:{Authorization:`Bearer ${a.props.accessToken}`}}),l({title:"Lot was canceled",status:"success",duration:3e3,isClosable:!0});return}await m.post(`https://api.silentclient.net/marketplace/item/${i.type}/${i.id}/buy_lot`,{id:n.id},{headers:{Authorization:`Bearer ${a.props.accessToken}`}}),l({title:"Lot was buyed",status:"success",duration:3e3,isClosable:!0})}catch(v){C(v,l)}finally{p(),a.updateUser()}},maxW:"100px",w:"full",children:n.user_id===((t=a.props.account)==null?void 0:t.id)?"Cancel":"Buy"})]})})]})})]}),e.jsx(se,{isOpen:u.isOpen,onClose:u.onClose,item:s,getData:p,type:h})]})}export{le as default};
